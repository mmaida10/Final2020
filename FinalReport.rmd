---
title: "Covid-91 Vaccine Study Final2021"
author: "Michael Maida"
date: "4 December 2021"
output: 
    html_document:
    toc: true
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="covid91.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))

FinalData <- FinalData %>% mutate_if(is.character, as.factor)
FinalData$treatment <- relevel(FinalData$treatment, ref = "placebo")
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of sub-populations tracked. Consider population subgroups by gender (guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

For the purposes of this report, the words "study drug," "Covid91," and "study vaccination" will be used interchangeably.

# Guys

### Graphical Analysis 

```{r}
Guys <- filter(FinalData, sex == "guy")

barchartGC(~infected + treatment, data = Guys)
barchartGC(~infected + treatment, data = Guys, type="percent")
```

This first bar chart compares the frequency of patients that take the study vaccination versus those who don't when they have Covid or OK. It shows that, while the number of people that are OK far outweigh those who have Covid, those who were infected with Covid were more often study drug users. The second bar chart, which compares the percentages of patients with and without the study vaccination, shows that there were 10% more  patients who were infected with Covid while having received the covid91 study vaccination. Overall, this indicates that the study vaccination is not only ineffective in men, but potentially even increases the likelihood of catching Covid-19.

### Numerical Analysis  

```{r}
table1 <- xtabs(~infected + treatment, data = Guys)
colPerc(table1)
rowPerc(table1)
```

These tables expands upon the graphical data found beforehand. The first table shows what percent of study drug users were infected with Covid or were OK, and the second table depicts what percent of those OK or infected with Covid received the study drug vs the placebo. The first table shows that nearly 97% of all the participants never received Covid-19. The second graph shows that there were around 10% more patients infected with Covid-19 who received the study drug than those who received the placebo. Overall, this indicates that the study vaccination is not only ineffective in men, but potentially even increases the likelihood of catching Covid-19.

### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)

Guysmod <- fisher.test(table1)
Guyseff <- (Guysmod$estimate/(Guysmod$estimate+1))*100
Guyseffuppereff <- (Guysmod$conf.int[2]/(Guysmod$conf.int[2]+1))*100
Guysefflowereff <- (Guysmod$conf.int[1]/(Guysmod$conf.int[1]+1))*100
options(digits = 3)
```

While the hypothesis states that there is a noticeable difference between study drug users versus placebo users, the null hypothesis submits that there is little to no difference between study drug users and placebo users in the getting infected with Covid-19. To test this, the chi square test and Fisher test were run, which indicated study drug users were infected with Covid-19 1.474 times more often than placebo users. The extremely low P-values shown above also indicate that the chance this result would be shown under the conditions of the null-hypothesis are extremely low. This is based on a 95% confidence band from 1.1767 to 1.8498. Thus, we reject the null hypothesis since there is a clear difference--the males are more likely to receive Covid-19 after this vaccintion. 

```{r}
Guymod <- fisher.test(table1)
guyeff <- (Guymod$estimate/(Guymod$estimate+1))*100
options(digits=2)
```

The study drug is `r guyeff`% effective for males. Based on these factors, I would not recommend guys to receive the Covid91 study drug.  

# Girls

### Graphical Analysis 

```{r}
Girls <- filter(FinalData, sex == "gal")

barchartGC(~infected + treatment, data = Girls)
barchartGC(~infected + treatment, data = Girls, type="percent")
```

This first bar chart compares the frequency of patients that take the study vaccination versus those who don't when they have Covid or OK. It shows that, while the number of girls that are OK far outweigh those who have Covid, those who were infected with Covid were less often study drug users. The second bar chart, which compares the percentages of patients with and without the study vaccination, shows that there were around 30% more  patients who were not infected with Covid while having received the Covid91 study vaccination. Overall, this indicates that the study vaccination is likely effective in women.

### Numerical Analysis  

```{r}
table1 <- xtabs(~infected + treatment, data = Girls)
colPerc(table1)
rowPerc(table1)
```

These tables expands upon the graphical data found beforehand. The first table shows what percent of female study drug users were infected with Covid or were OK, and the second table depicts what percent of those OK or infected with Covid received the study drug vs the placebo. The first table shows that nearly 95% of all the participants never received Covid-19. The second graph shows that there were around 33% more patients who were not infected with Covid-19 who received the study drug than those who received the placebo. Overall, this indicates that the study vaccination is likely effective in women.

### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)

Girlsmod <- fisher.test(table1)
Girlseff <- (Girlsmod$estimate/(Girlsmod$estimate+1))*100
Girlseffuppereff <- (Girlsmod$conf.int[2]/(Girlsmod$conf.int[2]+1))*100
Girlsefflowereff <- (Girlsmod$conf.int[1]/(Girlsmod$conf.int[1]+1))*100
options(digits = 3)
```

While the hypothesis states that there is a noticeable difference between female study drug users versus placebo users, the null hypothesis submits that there is little to no difference between study drug users and placebo users in the getting infected with Covid-19. To test this, the chi square test and Fisher test were run, which indicated study drug users were infected with Covid-19 0.489 times more often than placebo users. The extremely low P-values shown above also indicate that the chance this result would be shown under the conditions of the null-hypothesis are extremely low. This is based on a 95% confidence band from 0.409 to 0.584. Thus, we reject the null hypothesis.  

```{r}
Girlmod <- fisher.test(table1)
girleff <- ((Girlmod$estimate/(Girlmod$estimate+1)))*100
options(digits=1)
girleff
```

The study drug is `r girleff`% effective on females. Based on these factors, I would recommend girls to receive the Covid91 study drug, since it is clearly effective. 

# LGBTQ


### Graphical Analysis 

```{r}
LGBTQ <- filter(FinalData, LGBTQ == "gay")

barchartGC(~infected + treatment, data = LGBTQ)
barchartGC(~infected + treatment, data = LGBTQ, type="percent")
options(digits=3)
```

This first bar chart compares the frequency of gay patients that take the study vaccination versus those who don't when they have Covid or OK. It shows that, while the number of people that are OK far outweigh those who have Covid, those who were were infected with Covid-19 were more often study drug users. The second bar chart, which compares the percentages of patients with and without the study vaccination, shows that there were around 40% more  patients who were  infected with Covid while having received the covid91 study vaccination. Overall, this indicates that the study vaccination is very likely ineffective in homosexuals.

### Numerical Analysis  

```{r}
table1 <- xtabs(~infected + treatment, data = LGBTQ)
colPerc(table1)
rowPerc(table1)
```

These tables expands upon the graphical data found beforehand. The first table shows what percent of study drug users were infected with Covid or were OK, and the second table depicts what percent of those OK or infected with Covid received the study drug vs the placebo. The first table shows that nearly 96% of all the participants never received Covid-19. The second graph shows that there were around 41% more patients infected with Covid-19 who received the study drug than those who received the placebo. Overall, this indicates that the study vaccination is not only ineffective in homosexuals, but potentially even increases the likelihood of catching Covid-19.

### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)

LGBTQmod <- fisher.test(table1)
LGBTQeff <- (LGBTQmod$estimate/(LGBTQmod$estimate+1))*100
LGBTQeffuppereff <- (LGBTQmod$conf.int[2]/(LGBTQmod$conf.int[2]+1))*100
LGBTQefflowereff <- (LGBTQmod$conf.int[1]/(LGBTQmod$conf.int[1]+1))*100
options(digits = 3)
```

While the hypothesis states that there is a noticeable difference between gay study drug users versus placebo users, the null hypothesis submits that there is little to no difference between study drug users and placebo users in the getting infected with Covid-19. To test this, the chi square test and Fisher test were run, which indicated study drug users were infected with Covid-19 `r LGBTQmod$estimate` times more often than placebo users. The low P-values shown above also indicate that the chance this result would be shown under the conditions of the null-hypothesis are low. This is based on a 95% confidence band from `r LGBTQmod$conf.int[1]` to `r LGBTQmod$conf.int[2]`. Thus, we reject the null hypothesis.  

The study drug is `r LGBTQeff`% effective on homosexuals, which is based on a confidence interval of `r LGBTQefflowereff` to `r LGBTQeffuppereff`. Based on these factors, I would not recommend homosexuals to receive the Covid91 study drug. 

# Drug Users

### Graphical Analysis 

```{r}
druguser <- filter(FinalData, DrugUser == "yes")

barchartGC(~infected + treatment, data = druguser)
barchartGC(~infected + treatment, data = druguser, type="percent")
options(digits=3)
```

This first bar chart compares the frequency of drug-using patients that take the study vaccination versus those who don't when they have Covid or OK. It shows that, while the number of people that are OK far outweigh those who have Covid, those who were were infected with Covid-19 were more often taking the placebo. The second bar chart, which compares the percentages of patients with and without the study vaccination, shows that there were around 30% more  patients who were not infected with Covid while having received the covid91 study vaccination. Overall, this indicates that the study vaccination is very likely effective in drug users.

### Numerical Analysis  

```{r}
table1 <- xtabs(~infected + treatment, data = druguser)
colPerc(table1)
rowPerc(table1)
```

These tables expands upon the graphical data found beforehand. The first table shows what percent of study drug users were infected with Covid or were OK, and the second table depicts what percent of those OK or infected with Covid received the study drug vs the placebo. The first table shows that nearly 94% of all the participants never received Covid-19. The second graph shows that there were around 33% less patients infected with Covid-19 who received the study drug than those who received the placebo. Overall, this indicates that the study vaccination is likely effective in drug users.

### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)

drugusermod <- fisher.test(table1)
drugusereff <- (drugusermod$estimate/(drugusermod$estimate+1))*100
drugusereffuppereff <- (drugusermod$conf.int[2]/(drugusermod$conf.int[2]+1))*100
druguserefflowereff <- (drugusermod$conf.int[1]/(drugusermod$conf.int[1]+1))*100
options(digits = 3)
```

While the hypothesis states that there is a noticeable difference between drug-using study drug users versus drug-using placebo users, the null hypothesis submits that there is little to no difference between study drug users and placebo users in the getting infected with Covid-19. To test this, the chi square test and Fisher test were run, which indicated study drug users were infected with Covid-19 `r drugusermod$estimate` times more often than placebo users. The extremely low P-values shown above also indicate that the chance this result would be shown under the conditions of the null-hypothesis are extremely low. This is based on a 95% confidence band from `r drugusermod$conf.int[1]` to `r drugusermod$conf.int[2]`. Thus, we reject the null hypothesis.  

The study drug is `r drugusereff`% effective on drug users, which is based on a confidence interval of `r druguserefflowereff` to `r drugusereffuppereff`. Based on these factors, I would recommend drug users to receive the Covid91 study drug. 

# Final Conclusions

In this study, we compared the 4 different groups to each other: we compared the efficacy of the covid91 study vaccination on Guys, Gals, Homosexuals, and Drug-users. We discovered that this study drug was innefficient in guys and homosexuals but effective in females and drug users. Overall, further experimentation is needed to determine how effective this drug will be, especially on groups like homosexual females or drug-using males.